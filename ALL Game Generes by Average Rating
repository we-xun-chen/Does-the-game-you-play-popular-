import pandas as pd
import ast
import matplotlib.pyplot as plt

import os
os.chdir('/content/drive/MyDrive/ENFIN')  # Colab æ›è·¯å¾‘ä½¿ç”¨

# 1. è®€å– Excel æª”æ¡ˆ
file_path = "ana.xlsx"  # è«‹ç¢ºèªæ­¤è·¯å¾‘èˆ‡æª”æ¡ˆåç¨±æ­£ç¢º
df = pd.read_excel(file_path)

# 2. å°‡ Genres æ¬„ä½è½‰ç‚º listï¼ˆå¾å­—ä¸²æ ¼å¼ï¼‰
df['Genres'] = df['Genres'].dropna().apply(ast.literal_eval)

# 3. å°‡å¤šåˆ†é¡å±•é–‹ç‚ºå¤šåˆ—
df_exploded = df.explode('Genres')

# 4. å»é™¤ç©ºç™½èˆ‡ç¼ºå¤±å€¼
df_exploded['Genres'] = df_exploded['Genres'].str.strip()
df_exploded = df_exploded.dropna(subset=['Genres', 'Rating'])

# 5. ç¢ºä¿ Rating ç‚ºæ•¸å€¼å‹æ…‹
df_exploded['Rating'] = pd.to_numeric(df_exploded['Rating'], errors='coerce')

# 6. åˆ†é¡è¨ˆç®—å¹³å‡è©•åˆ†
genre_rating_avg = df_exploded.groupby('Genres')['Rating'].mean().sort_values(ascending=False)

# 7. é¡¯ç¤ºå‰10åçµæœ
print("ğŸ® éŠæˆ²åˆ†é¡å¹³å‡è©•åˆ†:")
print(genre_rating_avg.head(23))

# 8. ç•«å‡ºé•·æ¢åœ–
plt.figure(figsize=(12, 6))
genre_rating_avg.head(23).plot(kind='bar', color='skyblue')
plt.title('ALL Game Generes by Average Rating')
plt.xlabel('Genre')
plt.ylabel('Average Rating')
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
